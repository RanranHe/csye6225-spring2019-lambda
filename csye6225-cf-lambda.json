{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "LambdaEmailApplication": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {"Fn::Join": ["",["code-deploy.",{"Ref": "DomainName"}]]},
          "S3Key": {"Ref": "S3AppZipKey"}
        },
        "Description": "A lambda function for reset password email service",
        "FunctionName": {"Ref": "LambdaFuntionName"},
        "Handler": {"Ref": "LambdaFuntionHandlerName"},
        "Role": {
          "Fn::GetAtt": [
            "LambdaExecutionRole",
            "Arn"
          ]
        },
        "Runtime": {"Ref": "LambdaFuntionRuntime"},
        "Timeout": 10
      }
    },
    "LambdaInvokePermission": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "Principal": "sns.amazonaws.com",
        "SourceArn": {
          "Ref": "PasswordResetSNSTopic"
        },
        "FunctionName": {
          "Fn::GetAtt": [
            "LambdaEmailApplication",
            "Arn"
          ]
        }
      }
    }
  },
  "Parameters": {
    "DomainName": {
      "Type": "String",
      "Default": "csye6225-fall2018-default.me"
    },
    "S3AppZipKey": {
      "Type": "String",
      "Default": "csye6225-reset-email-service.zip"
    },
    "LambdaFuntionName": {
      "Type": "String",
      "Default": "default-name"
    },
    "LambdaFuntionHandlerName": {
      "Type": "String",
      "Default": "default-handler"
    },
    "LambdaFuntionRuntime": {
      "Type": "String",
      "Default": "default-runtime"
    }
  }
}
